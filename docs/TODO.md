# TODO

## Done

- ✅ rename current netlify site `npc->cli` -> `the-last-redoubt`
  - https://the-last-redoubt.netlify.app/test/
  - https://staging.lastredoubt.co
- ✅ connect new netlify deploy, named `npc-cli`
  - https://npc-cli.netlify.app/
- ✅ fix initial font load: svg fontawesome
- ✅ start new desktop layout i.e. with right-pane
- ✅ use system fonts instead of web fonts

- ✅ add mobile layout i.e. with lower-pane
- ✅ mobile layout fixes

- ✅ easier to close Nav
- ✅ easier to close Viewer

- ✅ Viewer has Tabs
  - try avoid "cannot update component" error
- ✅ fix Viewer side-by-side Tabs minimize in large viewport

- ✅ fix layout height on mobile device

- ✅ useSiteStore drives Nav
- ✅ open Viewer closes Nav
- ✅ open Nav darkens Main
- ✅ Viewer Tabs has id `{articleKey}-viewer-tabs` (for persist)

- ✅ Tabs has controls
  - ✅ small viewport ui
  - ✅ large viewport ui
  - ✅ disable/enable
  - ✅ reset
  - ✅ maximise/minimise
    - by expanding Viewer

- ✅ can reset while paused
- ✅ close Viewer disables Tabs
- ✅ can max/min while paused
- ✅ can make Viewer larger

- ✅ fix max Viewer in large viewport
- ✅ Viewer tabs does not need to know articleKey
- ✅ fix darken overlay in small viewport
- ✅ move Controls outside Tabs as ViewerControls
- ✅ move Toggle inside ViewerControls
- ✅ ViewerControls always visible
- ✅ ViewerControls buttons/Toggle not positioned absolute
- ✅ remember if Viewer is open and trigger client-side

- ✅ can drag Viewer bar
  - ✅ can drag "drag-bar" instead
  - ✅ drag to 0% and let go => sets viewOpen `false`
  - ✅ when viewOpen false can start dragging
  - ✅ add overlay when dragging (body can be covered by iframe)
  - ✅ get resize working on mobile
  - ❌ CSS var --view-size driven by useSite

- ✅ Couldn't scroll iframe in `<Comments>`
  - Problem disappeared after restarting Chrome

- ✅ Nav icons for Blog, Dev, Help, About

  - Blog: `robot`
  - Dev: `code`
  - Help: `circle-question`
  - About: `circle-info`

- ❌ toasts indicate loading assets/components

- ✅ copy over sh folder
  - comment out references to e.g. World, NPC, Geom, PanZoom,
- ✅ rename src/js -> src/npc-cli
- ✅ add Terminal
  - ✅ add files to src/npc-cli/terminal
  - ✅ move tabs inside npc-cli
  - ✅ can see component in Tabs

- ✅ ensure Tab components are lazy-loaded

- ❌ pivot to NPC fixes in repo `the-last-redoubt`
  - Spine-based animation not good enough
  - too many other issues e.g. collisions

- ✅ add `npc-cli/geom`
- ✅ starting migrating `npc-cli/graph`

- ✅ setup SVG symbols (simplify existing system)
  - ✅ hull symbol
  - ✅ non-hull symbol
  - ✅ `yarn symbols-meta`
    - ✅ try universal replacement for cheerio `htmlparser2`
  - ✅ script watches files
  - ✅ other hull symbols
  - ✅ can extract `gm.pngRect`
    - ✅ given def `gms` construct each `gm.pngRect`
      - i.e. `layout.items[0].pngRect` (hull symbol)
      - i.e. from symbolLookup generated by `yarn svg-meta`

- ✅ add working react-three-fiber demo R3FDemo

- ✅ Tab doesn't need to use react-query
- ✅ If Tabs enabled, Reset does not disable
- ✅ Tabs should go disabled on when leave view
- ❌ No resize Canvas when not rendering
  - part of `Canvas`

- ✅ R3FDemo (TestWorld) improvements
  - ✅ renderer stops when paused
  - ✅ mouse zooms to point under cursor
  - ✅ initially rotates
  - ✅ fix z-fighting (hack)
  - ✅ rename as TestWorld; rename worker demo as TestWorker
  - ✅ fix z-fighting properly: additive blending, depthWrite false
  - ✅ "Preserve" R3FDemo height when disabled
  - ❌ start migrating character controller with soldier.fbx
    - https://discourse.threejs.org/t/character-controller/46936

## WIP

- ✅ try https://github.com/pmndrs/react-three-offscreen
  - ✅ create simple demo
  - ✅ fixing resizing
  - ✅ add prop-passing via messaging
    - ✅ keep worker in another file
    - ✅ test patch
    - https://github.com/pmndrs/react-three-offscreen/issues/8#issuecomment-1975397224

- ✅ non-terminal tab disabled when other tab maximized
  - TestWorker was showing when Tab was minimized

- ✅ Can Esc/Enter to enable/disable in Terminal/Tabs
- ✅ Terminal rendered using WebGL
  - fix HMR via `npm i xterm-addon-webgl` https://github.com/xtermjs/xterm.js/issues/4757

- CharacterController
  - simple demo using https://github.com/pmndrs/ecctrl
  - change character
  - click to move
  - extract code, removing e.g. ray-cast

- Learn about WebGl RenderTargets
  - https://blog.maximeheckel.com/posts/the-study-of-shaders-with-react-three-fiber/
  - https://blog.maximeheckel.com/posts/beautiful-and-mind-bending-effects-with-webgl-render-targets/

- start GeomorphEdit
  - migrate Triangle

- try migrate R3FDemo to react-three-offscreen

- sh `test {fn}` evaluates function with `map` args
- improve MapControls zoomToCursor on mobile
- Terminal crashing during HMR
- (hull) walls -> quads
- need to remove labels from hull symbol image?

- world editor in new repo
- geomorph editor in new repo
- despite our "generic aim" (fabricating game masters),
  some context will help e.g. The Last Redoubt

- ✅ smaller collapsed nav on mobile
- fix multi-touch flicker on drag
  - setup local dev on phone to debug this
- can add Tabs via links in blog posts
  - without remounting other tabs!
- open Viewer should enable Tabs initially
- can press Escape/Enter to pause/unpause
- how does shell function versioning work in sh/scripts.ts?
- fix vertical tab drag on mobile
  - need repro

- iOS issues:
  - ✅ Nav wasn't centred
  - ✅ Viewer initially partially occluded
  - seems fixed on iPhone 13

- more decor images
  - `computer-2`
  - `speaker-1`
  - `communicator-1`
  - `fabricator-1`
- place decor points on many tables
- more tables in 301
- more tables in 101
- World WebGL rendering pauses on pause Tabs

- install cypress to test terminal
- netlify site `npc-cli` at https://lastredoubt.co
